<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>YCCC Nursing Lab Inventory Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.0/dist/full.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://sdk.userbase.com/2/userbase.js"></script>
    <script src="js/config.js" type="module"></script>
    <style>
        .low-stock { border-left: 4px solid #ef4444; }
        .medium-stock { border-left: 4px solid #f59e0b; }
        .high-stock { border-left: 4px solid #10b981; }
        .search-highlight { background-color: #fef3c7; font-weight: bold; }
        .category-badge { font-size: 0.75rem; }
        .loading { opacity: 0.6; pointer-events: none; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Auth Screen Specific Styles */
        .auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="bg-base-100">
    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-container hidden">
        <!-- Configuration Help Banner -->
        <div id="configHelp" class="alert alert-warning mb-4 max-w-md mx-auto" style="display: none;">
            <div>
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <h3 class="font-bold">Configuration Required</h3>
                    <div class="text-xs">Please set up your environment variables in the .env file</div>
                </div>
            </div>
        </div>
        
        <div class="card bg-base-100 shadow-xl w-full max-w-md">
            <div class="card-body">
                <div class="text-center mb-6">
                    <i class="fas fa-hospital-alt text-4xl text-primary mb-4"></i>
                    <h2 class="card-title text-2xl justify-center">YCCC Nursing Lab</h2>
                    <p class="text-base-content opacity-70">Inventory Management System</p>
                    <p class="text-sm text-base-content opacity-60 mt-2">York County Community College</p>
                </div>
                
                <div id="loginForm" class="space-y-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Username</span>
                        </label>
                        <input type="text" id="loginUsername" placeholder="Enter username" class="input input-bordered" />
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Password</span>
                        </label>
                        <input type="password" id="loginPassword" placeholder="Enter password" class="input input-bordered" />
                    </div>
                    <button class="btn btn-primary w-full" id="loginBtn">
                        <i class="fas fa-sign-in-alt mr-2"></i>Sign In
                    </button>
                    <div class="divider">OR</div>
                    <button class="btn btn-outline w-full" id="showSignupBtn">
                        <i class="fas fa-user-plus mr-2"></i>Create New Account
                    </button>
                </div>

                <div id="signupForm" class="space-y-4 hidden">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Username</span>
                        </label>
                        <input type="text" id="signupUsername" placeholder="Choose username" class="input input-bordered" />
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Password</span>
                        </label>
                        <input type="password" id="signupPassword" placeholder="Choose password" class="input input-bordered" />
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Confirm Password</span>
                        </label>
                        <input type="password" id="confirmPassword" placeholder="Confirm password" class="input input-bordered" />
                    </div>
                    <button class="btn btn-primary w-full" id="signupBtn">
                        <i class="fas fa-user-plus mr-2"></i>Create Account
                    </button>
                    <button class="btn btn-outline w-full" id="showLoginBtn">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Sign In
                    </button>
                </div>

                <div id="authLoading" class="text-center py-4 hidden">
                    <span class="loading loading-spinner loading-lg text-primary"></span>
                    <p class="mt-2">Authenticating...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application (hidden until authenticated) -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <div class="navbar bg-primary text-primary-content shadow-lg">
            <div class="flex-1">
                <i class="fas fa-hospital-alt text-2xl mr-3"></i>
                <h1 class="text-xl font-bold">YCCC Nursing Lab Inventory</h1>
            </div>
            <div class="flex-none gap-2">
                <div class="badge badge-secondary badge-lg">
                    <span id="totalItems">0</span> Items
                </div>
                <div id="connectionStatus" class="badge badge-success badge-sm">
                    <i class="fas fa-wifi mr-1"></i>Connected
                </div>
                <!-- User Dropdown - Re-added -->
                <div class="dropdown dropdown-end">
                    <label tabindex="0" class="btn btn-ghost btn-sm" id="userDropdownToggle">
                        <i class="fas fa-user mr-2"></i>
                        <span id="currentUser"></span>
                        <i class="fas fa-chevron-down ml-2"></i>
                    </label>
                    <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                        <li><a id="logoutBtn"><i class="fas fa-sign-out-alt mr-2"></i>Sign Out</a></li>
                    </ul>
                </div>
                <!-- Database Setup Button - Re-added from old HTML but modified to show Userbase config -->
                <button class="btn btn-ghost btn-sm" id="configBtn">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>

        <!-- Dashboard Stats - From old HTML -->
        <div class="container mx-auto p-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="stat bg-base-200 rounded-lg shadow">
                    <div class="stat-figure text-primary">
                        <i class="fas fa-boxes text-2xl"></i>
                    </div>
                    <div class="stat-title">Total Items</div>
                    <div class="stat-value text-primary" id="statTotal">0</div>
                </div>
                <div class="stat bg-base-200 rounded-lg shadow">
                    <div class="stat-figure text-warning">
                        <i class="fas fa-exclamation-triangle text-2xl"></i>
                    </div>
                    <div class="stat-title">Low Stock</div>
                    <div class="stat-value text-warning" id="statLowStock">0</div>
                </div>
                <div class="stat bg-base-200 rounded-lg shadow">
                    <div class="stat-figure text-info">
                        <i class="fas fa-map-marker-alt text-2xl"></i>
                    </div>
                    <div class="stat-title">Locations</div>
                    <div class="stat-value text-info" id="statLocations">0</div>
                </div>
                <div class="stat bg-base-200 rounded-lg shadow">
                    <div class="stat-figure text-success">
                        <i class="fas fa-tags text-2xl"></i>
                    </div>
                    <div class="stat-title">Categories</div>
                    <div class="stat-value text-success" id="statCategories">0</div>
                </div>
            </div>

            <!-- Action Buttons - From old HTML -->
            <div class="flex flex-wrap gap-2 mb-6">
                <button class="btn btn-primary" id="showAddItemModalBtn">
                    <i class="fas fa-plus mr-2"></i>Add New Item
                </button>
                <button class="btn btn-secondary" id="exportDataBtn">
                    <i class="fas fa-download mr-2"></i>Export Data
                </button>
                <button class="btn btn-accent" id="showImportModalBtn">
                    <i class="fas fa-upload mr-2"></i>Smart Import CSV
                </button>
                <button class="btn btn-info" id="sampleDataBtn">
                    <i class="fas fa-database mr-2"></i>Load Sample Data
                </button>
            </div>

            <!-- Search and Filters - From old HTML -->
            <div class="card bg-base-200 shadow-lg mb-6">
                <div class="card-body">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <!-- Search -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">
                                    <i class="fas fa-search mr-2"></i>Search Items
                                </span>
                            </label>
                            <input type="text" id="searchInput" placeholder="Search by item name or description..." 
                                   class="input input-bordered w-full" />
                        </div>

                        <!-- Location Filter -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Location
                                </span>
                            </label>
                            <select id="locationFilter" class="select select-bordered w-full">
                                <option value="">All Locations</option>
                            </select>
                        </div>

                        <!-- Category Filter -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">
                                    <i class="fas fa-tags mr-2"></i>Category
                                </span>
                            </label>
                            <select id="categoryFilter" class="select select-bordered w-full">
                                <option value="">All Categories</option>
                            </select>
                        </div>

                        <!-- Stock Level Filter -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">
                                    <i class="fas fa-chart-bar mr-2"></i>Stock Level
                                </span>
                            </label>
                            <select id="stockFilter" class="select select-bordered w-full">
                                <option value="">All Stock Levels</option>
                                <option value="low">Low Stock (≤5)</option>
                                <option value="medium">Medium Stock (6-20)</option>
                                <option value="high">High Stock (>20)</option>
                                <option value="empty">No Quantity Listed</option>
                            </select>
                        </div>
                    </div>

                    <!-- Sort Options - From old HTML -->
                    <div class="flex flex-wrap gap-2 mt-4">
                        <button class="btn btn-sm btn-outline" id="sortByNameBtn">
                            <i class="fas fa-sort-alpha-down mr-1"></i>Sort by Name
                        </button>
                        <button class="btn btn-sm btn-outline" id="sortByQuantityBtn">
                            <i class="fas fa-sort-numeric-down mr-1"></i>Sort by Quantity
                        </button>
                        <button class="btn btn-sm btn-outline" id="sortByLocationBtn">
                            <i class="fas fa-sort mr-1"></i>Sort by Location
                        </button>
                        <button class="btn btn-sm btn-primary" id="resetFiltersBtn">
                            <i class="fas fa-refresh mr-1"></i>Reset Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Info - From old HTML -->
            <div class="flex justify-between items-center mb-4">
                <div class="text-sm opacity-70">
                    Showing <span id="resultCount">0</span> of <span id="totalCount">0</span> items
                </div>
                <div class="flex gap-2">
                    <div class="badge badge-error badge-sm">
                        <div class="w-2 h-2 bg-red-500 rounded-full mr-1"></div>
                        Low Stock
                    </div>
                    <div class="badge badge-warning badge-sm">
                        <div class="w-2 h-2 bg-yellow-500 rounded-full mr-1"></div>
                        Medium Stock
                    </div>
                    <div class="badge badge-success badge-sm">
                        <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                        High Stock
                    </div>
                </div>
            </div>

            <!-- Loading Indicator - From old HTML -->
            <div id="loadingIndicator" class="text-center py-8 hidden">
                <span class="loading loading-spinner loading-lg text-primary"></span>
                <p class="mt-2 text-base-content opacity-60">Loading inventory...</p>
            </div>

            <!-- Inventory Grid - From old HTML -->
            <div id="inventoryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <!-- Items will be populated here -->
            </div>

            <!-- No Results Message - From old HTML -->
            <div id="noResults" class="text-center py-12 hidden">
                <i class="fas fa-search text-4xl text-base-300 mb-4"></i>
                <h3 class="text-xl font-semibold text-base-content mb-2">No items found</h3>
                <p class="text-base-content opacity-60">Try adjusting your search criteria or filters</p>
            </div>
        </div>
    </div>

    <!-- Database Setup Modal - From old HTML, adapted for Userbase -->
    <div id="databaseSetupModal" class="modal">
        <div class="modal-box max-w-4xl">
            <h3 class="font-bold text-lg mb-4">Database & Authentication Configuration</h3>
            <div class="space-y-4">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <h4 class="font-bold">Setup Instructions:</h4>
                        <ol class="list-decimal list-inside mt-2 space-y-1 text-sm">
                            <li>Ensure your GitHub repository secrets (`VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`, `VITE_USERBASE_APP_ID`) are set.</li>
                            <li>If running locally, create a `.env` file with these variables (prefixed with `VITE_`).</li>
                            <li>Your Supabase table (`inventory_items`) and RLS policies have been automatically set up by the AI.</li>
                            <li>If you encounter issues, check your browser console for errors.</li>
                        </ol>
                    </div>
                </div>
                
                <div class="form-control">
                    <label class="cursor-pointer label">
                        <span class="label-text">Enable Demo Mode (Local Storage) - No database or signup required</span>
                        <input type="checkbox" id="demoMode" class="checkbox" />
                    </label>
                </div>

                <div id="supabaseConfigFields" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Supabase Project URL</span>
                        </label>
                        <input type="url" id="supabaseUrl" placeholder="https://your-project.supabase.co" 
                               class="input input-bordered" />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Supabase Anon Key</span>
                        </label>
                        <input type="password" id="supabaseKey" placeholder="Your anon public key" 
                               class="input input-bordered" />
                    </div>
                </div>
                
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Userbase App ID</span>
                    </label>
                    <input type="text" id="userbaseAppId" placeholder="Your Userbase App ID" 
                           class="input input-bordered" />
                </div>

                <!-- Manual SQL Instructions - Updated -->
                <div class="collapse collapse-arrow bg-base-200">
                    <input type="checkbox" /> 
                    <div class="collapse-title text-sm font-medium">
                        <i class="fas fa-code mr-2"></i>Manual Database Setup (if auto-creation fails)
                    </div>
                    <div class="collapse-content text-xs">
                        <p class="mb-2">If you experience database errors, ensure the `inventory_items` table and RLS policies exist in your Supabase project. You can run this SQL in your Supabase SQL Editor:</p>
                        <div class="mockup-code">
                            <pre><code>-- Create the inventory_items table
CREATE TABLE IF NOT EXISTS public.inventory_items (
    id SERIAL PRIMARY KEY,
    user_id TEXT NOT NULL,
    item TEXT NOT NULL,
    description TEXT,
    location TEXT NOT NULL,
    shelf TEXT,
    tub TEXT,
    quantity TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE public.inventory_items ENABLE ROW LEVEL SECURITY;

-- Create policy for user isolation (all authenticated users see all data)
CREATE POLICY "Allow all operations for authenticated users" 
ON public.inventory_items FOR ALL 
USING (true);

-- Add indexes for better performance
CREATE INDEX IF NOT EXISTS idx_inventory_items_user_id ON public.inventory_items(user_id);
CREATE INDEX IF NOT EXISTS idx_inventory_items_created_at ON public.inventory_items(created_at);
CREATE INDEX IF NOT EXISTS idx_inventory_items_item ON public.inventory_items(item);
</code></pre>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-action">
                <button class="btn btn-primary" id="connectDbBtn">
                    <i class="fas fa-plug mr-2"></i>Connect &amp; Load
                </button>
                <button class="btn" id="closeDbBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Item Modal - From old HTML -->
    <div id="itemModal" class="modal">
        <div class="modal-box w-11/12 max-w-2xl">
            <h3 class="font-bold text-lg mb-4" id="modalTitle">Add New Item</h3>
            <form id="itemForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Item Name *</span>
                        </label>
                        <input type="text" id="itemName" name="item" required 
                               class="input input-bordered" placeholder="e.g., ABD Pads" />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Description</span>
                        </label>
                        <input type="text" id="itemDescription" name="description" 
                               class="input input-bordered" placeholder="e.g., 8&quot; X 10&quot;" />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Location *</span>
                        </label>
                        <select id="itemLocation" name="location" required class="select select-bordered">
                            <option value="">Select Location</option>
                            <option value="Storage Shelf # 1">Storage Shelf # 1</option>
                            <option value="Storage Shelf # 2">Storage Shelf # 2</option>
                            <option value="Wound Care Cart">Wound Care Cart</option>
                            <option value="Sink Counter">Sink Counter</option>
                            <option value="Assessment Cart">Assessment Cart</option>
                            <option value="Nurses Station">Nurses Station</option>
                            <option value="Under Nurses Station Counter">Under Nurses Station Counter</option>
                        </select>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Shelf/Drawer</span>
                        </label>
                        <input type="text" id="itemShelf" name="shelf" 
                               class="input input-bordered" placeholder="e.g., Right Drawer # 6" />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Tub Number</span>
                        </label>
                        <input type="text" id="itemTub" name="tub" 
                               class="input input-bordered" placeholder="e.g., 7" />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Quantity</span>
                        </label>
                        <input type="text" id="itemQuantity" name="quantity" 
                               class="input input-bordered" placeholder="e.g., 24 or 2 boxes" />
                    </div>
                </div>
                
                <div class="modal-action">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save mr-2"></i>Save Item
                    </button>
                    <button type="button" class="btn" id="closeItemModalBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Smart Import Modal - From old HTML -->
    <div id="importModal" class="modal">
        <div class="modal-box max-w-2xl">
            <h3 class="font-bold text-lg mb-4">Smart CSV Import</h3>
            <div class="space-y-4">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Select CSV File</span>
                    </label>
                    <input type="file" id="importFile" accept=".csv" class="file-input file-input-bordered" 
                           />
                </div>
                
                <div class="alert alert-success">
                    <i class="fas fa-magic"></i>
                    <div>
                        <h4 class="font-bold">Smart Import Features:</h4>
                        <ul class="text-sm mt-1 space-y-1">
                            <li>• Automatically handles uppercase/lowercase columns</li>
                            <li>• Maps common column variations (e.g., "SHELF #/DRAWER #" → "shelf")</li>
                            <li>• Shows preview before importing</li>
                            <li>• Skips empty rows automatically</li>
                        </ul>
                    </div>
                </div>

                <!-- CSV Preview -->
                <div id="csvPreview" class="hidden">
                    <h4 class="font-semibold mb-2">CSV Preview & Column Mapping:</h4>
                    <div class="overflow-x-auto">
                        <table class="table table-compact w-full">
                            <thead>
                                <tr>
                                    <th>CSV Column</th>
                                    <th>Maps To</th>
                                    <th>Sample Data</th>
                                </tr>
                            </thead>
                            <tbody id="csvPreviewBody">
                                <!-- Preview rows will be added here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-2">
                        <span class="text-sm opacity-70">Found <span id="previewRowCount">0</span> rows to import</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-action">
                <button class="btn btn-primary" id="importBtn" disabled>
                    <i class="fas fa-upload mr-2"></i>Import Data
                </button>
                <button class="btn" id="closeImportModalBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal - From old HTML -->
    <div id="deleteModal" class="modal">
        <div class="modal-box">
            <h3 class="font-bold text-lg text-error mb-4">Confirm Deletion</h3>
            <p class="mb-4">Are you sure you want to delete this item? This action cannot be undone.</p>
            <div class="bg-base-200 p-3 rounded mb-4">
                <p class="font-semibold" id="deleteItemName"></p>
                <p class="text-sm opacity-70" id="deleteItemDetails"></p>
            </div>
            
            <div class="modal-action">
                <button class="btn btn-error" id="confirmDeleteBtn">
                    <i class="fas fa-trash mr-2"></i>Delete
                </button>
                <button class="btn" id="closeDeleteModalBtn">Cancel</button>
            }
        }

        // --- Entry Point and Event Listeners ---
        // Initialize the application
        async function init() {
            try {
                // Check if configuration is properly set up
                if (!window.AppConfig.isConfigured()) {
                    document.getElementById('configHelp').style.display = 'block';
                    showToast('Please configure your environment variables', 'warning');
                    showDatabaseSetup(); // Show setup modal
                    return;
                }
                
                // Initialize Userbase
                const session = await userbase.init({ appId: CONFIG.userbase.appId });
                
                // Check if user is already signed in
                if (session.user) {
                    await handleSuccessfulAuth(session.user);
                } else {
                    showAuthScreen();
                }
            } catch (error) {
                console.error('Initialization error:', error);
                showToast('Failed to initialize application: ' + error.message, 'error'); 
                showAuthScreen(); // Ensure auth screen is visible on init error
            } finally {
                // Ensure event listeners are set up after DOM is ready and functions are defined
                setupEventListeners();
            }
        }

        function setupEventListeners() {
            // Authentication forms
            document.getElementById('loginBtn')?.addEventListener('click', handleLogin);
            document.getElementById('showSignupBtn')?.addEventListener('click', showSignupForm);
            document.getElementById('signupBtn')?.addEventListener('click', handleSignup);
            document.getElementById('showLoginBtn')?.addEventListener('click', showLoginForm);
            document.getElementById('logoutBtn')?.addEventListener('click', handleLogout);

            // Database setup modal
            document.getElementById('configBtn')?.addEventListener('click', showDatabaseSetup);
            document.getElementById('connectDbBtn')?.addEventListener('click', connectDatabase);
            document.getElementById('closeDbBtn')?.addEventListener('click', closeDatabaseSetup);
            document.getElementById('demoMode')?.addEventListener('change', toggleDemoModeFields);

            // Action buttons
            document.getElementById('showAddItemModalBtn')?.addEventListener('click', showAddItemModal);
            document.getElementById('exportDataBtn')?.addEventListener('click', exportData);
            document.getElementById('showImportModalBtn')?.addEventListener('click', showImportModal);
            document.getElementById('sampleDataBtn')?.addEventListener('click', initializeWithSampleData);

            // Search and filters
            document.getElementById('searchInput')?.addEventListener('input', filterAndSearch);
            document.getElementById('locationFilter')?.addEventListener('change', filterAndSearch);
            document.getElementById('categoryFilter')?.addEventListener('change', filterAndSearch);
            document.getElementById('stockFilter')?.addEventListener('change', filterAndSearch);
            document.getElementById('sortByNameBtn')?.addEventListener('click', () => sortItems('name'));
            document.getElementById('sortByQuantityBtn')?.addEventListener('click', () => sortItems('quantity'));
            document.getElementById('sortByLocationBtn')?.addEventListener('click', () => sortItems('location'));
            document.getElementById('resetFiltersBtn')?.addEventListener('click', resetFilters);

            // Item management modals
            document.getElementById('itemForm')?.addEventListener('submit', handleItemSubmit);
            document.getElementById('closeItemModalBtn')?.addEventListener('click', closeItemModal);
            document.getElementById('confirmDeleteBtn')?.addEventListener('click', confirmDelete);
            document.getElementById('closeDeleteModalBtn')?.addEventListener('click', closeDeleteModal);

            // CSV Import
            document.getElementById('importFile')?.addEventListener('change', previewCSV);
            document.getElementById('importBtn')?.addEventListener('click', importData);
            document.getElementById('closeImportModalBtn')?.addEventListener('click', closeImportModal);
        }

        // Start the application
        init();
    </script>
</body>
</html>